version: "3.9"
networks:
  default:
    driver: bridge
    ipam:
      config:
        - subnet: 172.16.20.0/22
services:
  hl-collector:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: hl-collector
    environment:
      # Comma-separated symbols; defaults match your script
      SYMBOLS: ${SYMBOLS:-ETH}
      OUTPUT_DIR: ${OUTPUT_DIR:-HL_data}
      ORDERBOOK_DEPTH: ${ORDERBOOK_DEPTH:-20}
      # Restart/reconnect if no data arrives for this many seconds
      INACTIVITY_TIMEOUT_SEC: ${INACTIVITY_TIMEOUT_SEC:-180}
      MAX_RECONNECT_ATTEMPTS: ${MAX_RECONNECT_ATTEMPTS:-3}
      RECONNECT_BACKOFF_SEC: ${RECONNECT_BACKOFF_SEC:-5}
      TZ: ${TZ:-UTC}
    volumes:
      # Persist data on the host; aligns with OUTPUT_DIR default
      - ./HL_data:/app/HL_data
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    command: ["python", "run_collector.py"]
